# API ä»£ç† & JSON è®¢é˜…å™¨

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Cloudflare Workers** çš„ä¸­è½¬ä»£ç† + JSON é…ç½®å‰ç¼€æ›¿æ¢å·¥å…·ã€‚

æ”¯æŒå°† API è¯·æ±‚é€šè¿‡ Worker è½¬å‘ï¼Œå¹¶è‡ªåŠ¨ä¸º JSON é…ç½®ä¸­çš„ `api` å­—æ®µæ·»åŠ /æ›¿æ¢å‰ç¼€ã€‚

åŒæ—¶æ”¯æŒç”Ÿæˆ **Base58 ç¼–ç çš„è®¢é˜…æ ¼å¼**ï¼Œå¹¶æä¾›**å¤šç§é…ç½®æºé€‰æ‹©**ï¼Œæ–¹ä¾¿åœ¨å¤–éƒ¨åº”ç”¨ä¸­å¿«é€Ÿä½¿ç”¨ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. é€šç”¨ API ä»£ç†

ä½¿ç”¨ `?url=` å‚æ•°è½¬å‘ä»»æ„ API è¯·æ±‚

**ç¤ºä¾‹ï¼š**

```
https://<ä½ çš„åŸŸå>/?url=https://ikunzyapi.com/api.php/provide/vod/
```

### 2. å¤šé…ç½®æºæ”¯æŒ

ä½¿ç”¨ `?source=` å‚æ•°é€‰æ‹©ä¸åŒçš„èµ„æºé…ç½®ï¼š

- **`source=jin18`** - ç²¾ç®€ç‰ˆï¼ˆ31ä¸ªèµ„æºï¼Œä»…æ™®é€šå†…å®¹ï¼‰
- **`source=jingjian`** - ç²¾ç®€+æˆäººç‰ˆï¼ˆ61ä¸ªèµ„æºï¼‰
- **`source=full`** - å®Œæ•´ç‰ˆï¼ˆ88ä¸ªèµ„æºï¼Œ**é»˜è®¤**ï¼‰

### 3. ç»Ÿä¸€çš„ format å‚æ•°

ä½¿ç”¨ `?format=` å‚æ•°æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼ˆåˆå¹¶äº†åŸæ¥çš„ config å’Œ encode å‚æ•°ï¼‰ï¼š

- **`format=0`** æˆ– **`format=raw`** - åŸå§‹ JSON
- **`format=1`** æˆ– **`format=proxy`** - æ·»åŠ ä»£ç†å‰ç¼€çš„ JSON
- **`format=2`** æˆ– **`format=base58`** - åŸå§‹ JSON çš„ Base58 ç¼–ç 
- **`format=3`** æˆ– **`format=proxy-base58`** - ä»£ç†å‰ç¼€ JSON çš„ Base58 ç¼–ç 

**ç¤ºä¾‹ï¼š**

```jsx
// è·å–å¸¦ä»£ç†å‰ç¼€çš„ JSON
https://<ä½ çš„åŸŸå>/?format=1&source=jin18

// è·å–ä»£ç† Base58 ç¼–ç è®¢é˜…
https://<ä½ çš„åŸŸå>/?format=3&source=full
```

### 5. åŠ¨æ€ç¤ºä¾‹ç”Ÿæˆ

HTML é¡µé¢ä¼šæ ¹æ®å½“å‰åŸŸåè‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹é“¾æ¥ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹

---

## ğŸš€ éƒ¨ç½²æ–¹æ³•

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. æ–°å»ºä¸€ä¸ª **Workers & Pages â†’ Worker**
3. å°† `worker.js` ä»£ç ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­
4. ä¿å­˜å¹¶éƒ¨ç½²
5. åœ¨ Cloudflare Workers KV ä¸­åˆ›å»ºå‘½åç©ºé—´ï¼šåç§°ï¼šCONFIG_KV,ç»‘å®šå˜é‡åï¼šCONFIG_KV
6. ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

---

## ğŸ”— ä½¿ç”¨ç¤ºä¾‹

å‡è®¾ä½ çš„ Worker éƒ¨ç½²åœ¨ï¼š[`https://api.example.workers.dev`](https://api.example.workers.dev)

### ç¤ºä¾‹ 1ï¼šä»£ç†ä»»æ„ API

```
https://api.example.workers.dev/?url=https://ikunzyapi.com/api.php/provide/vod/
```

### ç¤ºä¾‹ 2ï¼šè·å–åŸå§‹ JSON é…ç½®ï¼ˆç²¾ç®€ç‰ˆï¼‰

```jsx
https://api.example.workers.dev/?format=0&source=jin18
```

### ç¤ºä¾‹ 3ï¼šè·å–å¸¦ä»£ç†å‰ç¼€çš„ JSON é…ç½®ï¼ˆå®Œæ•´ç‰ˆï¼‰

```jsx
https://api.example.workers.dev/?format=1&source=full
```

### ç¤ºä¾‹ 4ï¼šè·å–åŸå§‹ Base58 ç¼–ç ï¼ˆç²¾ç®€+æˆäººç‰ˆï¼‰

```jsx
https://api.example.workers.dev/?format=2&source=jingjian
```

### ç¤ºä¾‹ 5ï¼šè·å–ä»£ç† Base58 ç¼–ç è®¢é˜…ï¼ˆå®Œæ•´ç‰ˆï¼‰

```jsx
https://api.example.workers.dev/?format=3&source=full
```

### ç¤ºä¾‹ 6ï¼šè‡ªå®šä¹‰ä»£ç†å‰ç¼€

```jsx
https://api.example.workers.dev/?format=1&source=full&prefix=https://my-proxy.com/?url=
```

---

## ğŸ› ï¸ å‚æ•°è¯´æ˜

| å‚æ•°     | è¯´æ˜             | å¯é€‰å€¼                          | ç¤ºä¾‹         |        
| -------- | ---------------- | ------------------------------- | ------------ |
| `url`    | ä»£ç†ä»»æ„ API è¯·æ±‚ | ä»»æ„æœ‰æ•ˆ URL                     | `?url=https://...` |
| `format` | é…ç½®æ¨¡å¼         | `0 æˆ– raw = åŸå§‹ JSON`  `1 æˆ– proxy = æ·»åŠ ä»£ç†å‰ç¼€`  `2 æˆ– base58 = åŸå§‹ Base58`  `3 æˆ– proxy-base58 = ä»£ç† Base58` | `?format=0` |
| `source` | é…ç½®æºé€‰æ‹©       | `jin18` = ç²¾ç®€ç‰ˆ`jingjian` = ç²¾ç®€+æˆäºº`full` = å®Œæ•´ç‰ˆï¼‰ | `?source=jin18` |
| `prefix` | è‡ªå®šä¹‰ä»£ç†å‰ç¼€   | ä»»æ„ä»£ç†åœ°å€                      | `?prefix=https://.../?url=` |
| `errors&limit=10` | æŸ¥çœ‹é”™è¯¯æ—¥å¿— | `errors&limit=10`                 | `https://<ä½ çš„åŸŸå>?errors&limit=10` |

---

## ğŸ“¦ é…ç½®æºå¯¹æ¯”

| é…ç½®æº | èµ„æºæ•°é‡ | åŒ…å«æˆäººå†…å®¹ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- |
| **jin18** | 31ä¸ª | âŒ å¦ | å®¶åº­ä½¿ç”¨ã€è½»é‡çº§åº”ç”¨ |
| **jingjian** | 61ä¸ª | âœ… æ˜¯ | ä¸ªäººä½¿ç”¨ã€ä¸­ç­‰éœ€æ±‚ |
| **full** | 88ä¸ª | âœ… æ˜¯ | å®Œæ•´åŠŸèƒ½ã€æœ€å¤§å…¼å®¹æ€§ |

---

## ğŸ“‹ å®Œæ•´è®¢é˜…é“¾æ¥æ¨¡æ¿

å°† `\<ä½ çš„åŸŸå\>` æ›¿æ¢ä¸ºä½ çš„å®é™… Worker åœ°å€ï¼š

### ç²¾ç®€ç‰ˆï¼ˆjin18ï¼‰

```jsx
# åŸå§‹ JSON
https://<ä½ çš„åŸŸå>/?format=0&source=jin18

# å¸¦ä»£ç†å‰ç¼€çš„ JSON
https://<ä½ çš„åŸŸå>/?format=1&source=jin18

# åŸå§‹ Base58 ç¼–ç 
https://<ä½ çš„åŸŸå>/?format=2&source=jin18

# ä»£ç† Base58 ç¼–ç ï¼ˆæ¨èç”¨äºè®¢é˜…ï¼‰
https://<ä½ çš„åŸŸå>/?format=3&source=jin18
```

### ç²¾ç®€+æˆäººç‰ˆï¼ˆjingjianï¼‰

```jsx
# åŸå§‹ JSON
https://<ä½ çš„åŸŸå>/?format=0&source=jingjian

# å¸¦ä»£ç†å‰ç¼€çš„ JSON
https://<ä½ çš„åŸŸå>/?format=1&source=jingjian

# åŸå§‹ Base58 ç¼–ç 
https://<ä½ çš„åŸŸå>/?format=2&source=jingjian

# ä»£ç† Base58 ç¼–ç ï¼ˆæ¨èç”¨äºè®¢é˜…ï¼‰
https://<ä½ çš„åŸŸå>/?format=3&source=jingjian
```

### å®Œæ•´ç‰ˆï¼ˆfullï¼Œé»˜è®¤ï¼‰

```jsx
# åŸå§‹ JSON
https://<ä½ çš„åŸŸå>/?format=0&source=full

# å¸¦ä»£ç†å‰ç¼€çš„ JSON
https://<ä½ çš„åŸŸå>/?format=1&source=full

# åŸå§‹ Base58 ç¼–ç 
https://<ä½ çš„åŸŸå>/?format=2&source=full

# ä»£ç† Base58 ç¼–ç ï¼ˆæ¨èç”¨äºè®¢é˜…ï¼‰
https://<ä½ çš„åŸŸå>/?format=3&source=full
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

- **Workers å…è´¹é¢åº¦**ï¼šæ¯å¤© 10 ä¸‡æ¬¡è¯·æ±‚ï¼Œé€‚åˆè½»é‡ä½¿ç”¨ã€‚è¶…å‡ºåéœ€å‡çº§ä»˜è´¹å¥—é¤ã€‚
- **ä»£ç†æ›¿æ¢é€»è¾‘**ï¼šå¦‚æœ JSON ä¸­ `api` å­—æ®µå·²åŒ…å« `?url=` å‰ç¼€ï¼Œä¼šå…ˆå»æ‰æ—§å‰ç¼€ï¼Œå†åŠ ä¸Šæ–°å‰ç¼€ã€‚
- **Base58 è¾“å‡º**ï¼šé€‚åˆç›´æ¥ä½œä¸ºè®¢é˜…é“¾æ¥åœ¨æ”¯æŒè¯¥æ ¼å¼çš„å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ã€‚
- **é…ç½®æºæ›´æ–°**ï¼šé…ç½®æºæ¥è‡ª GitHubï¼Œå†…å®¹ä¼šå®šæœŸæ›´æ–°ã€‚Worker ä¼šç¼“å­˜ 7200 ç§’ï¼ˆ2å°æ—¶ï¼‰ã€‚
- **è¶…æ—¶è®¾ç½®**ï¼šé»˜è®¤è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º 9 ç§’ï¼Œè¶…æ—¶åä¼šè¿”å›é”™è¯¯ä¿¡æ¯ã€‚
- **CORS æ”¯æŒ**ï¼šå·²å¯ç”¨å®Œæ•´çš„ CORS æ”¯æŒï¼Œå¯ç›´æ¥åœ¨å‰ç«¯åº”ç”¨ä¸­è°ƒç”¨ã€‚

---

## ğŸ”§ é«˜çº§é…ç½®

### ä¿®æ”¹é…ç½®æºåœ°å€

åœ¨ `worker.js` ä¸­æ‰¾åˆ° `JSON_SOURCES` å¯¹è±¡å¹¶ä¿®æ”¹ï¼š

```jsx
const JSON_SOURCES = {
  'jin18': 'https://raw.githubusercontent.com/your-repo/jin18.json',
  'jingjian': 'https://raw.githubusercontent.com/your-repo/jingjian.json',
  'full': 'https://raw.githubusercontent.com/your-repo/full.json'
}
```

### ä¿®æ”¹è¶…æ—¶æ—¶é—´

æ‰¾åˆ°ä»¥ä¸‹ä»£ç å¹¶ä¿®æ”¹è¶…æ—¶æ¯«ç§’æ•°ï¼š

```jsx
const timeoutId = setTimeout(() => controller.abort(), 9000) // æ”¹ä¸ºå…¶ä»–å€¼
```

### æ·»åŠ è®¿é—®æ—¥å¿—

å¯ä»¥åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—è®°å½•ï¼š

```jsx
console.log(`Request from: ${request.headers.get('cf-connecting-ip')}`)
```

---

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æŸ¥çœ‹æˆ‘çš„ Worker åœ°å€ï¼Ÿ

A: éƒ¨ç½²ååœ¨ Cloudflare Dashboard çš„ Workers é¡µé¢å¯ä»¥çœ‹åˆ°ï¼Œæ ¼å¼é€šå¸¸ä¸º [`https://worker-name.your-subdomain.workers.dev`](https://worker-name.your-subdomain.workers.dev)

### Q: å¯ä»¥ç»‘å®šè‡ªå®šä¹‰åŸŸåå—ï¼Ÿ

A: å¯ä»¥ï¼åœ¨ Worker è®¾ç½®ä¸­ç‚¹å‡»ã€ŒTriggersã€â†’ã€ŒAdd Custom Domainã€ï¼Œæ·»åŠ ä½ çš„åŸŸåå³å¯ã€‚

### Q: ä¸ºä»€ä¹ˆè¿”å› 502 é”™è¯¯ï¼Ÿ

A: å¯èƒ½æ˜¯ç›®æ ‡ API è¶…æ—¶æˆ–æ— æ³•è®¿é—®ï¼Œæ£€æŸ¥ç›®æ ‡ URL æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è€…å°è¯•å¢åŠ è¶…æ—¶æ—¶é—´ã€‚

### Q: Base58 ç¼–ç åå¦‚ä½•è§£ç ï¼Ÿ

A: éœ€è¦ä½¿ç”¨æ”¯æŒ Base58 è§£ç çš„åº“æˆ–å®¢æˆ·ç«¯ï¼Œè§£ç åå³å¯å¾—åˆ°åŸå§‹ JSON é…ç½®ã€‚

### Q: é…ç½®æºå¤šä¹…æ›´æ–°ä¸€æ¬¡ï¼Ÿ

A: æ ¹æ® JSON ä¸­çš„ `cache_time: 7200`ï¼ˆç§’ï¼‰ï¼Œå»ºè®®å®¢æˆ·ç«¯æ¯ 2 å°æ—¶åˆ·æ–°ä¸€æ¬¡é…ç½®ã€‚

---

## ğŸ“„ è®¸å¯è¯

MIT License - è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ”¹è¿›æ­¤é¡¹ç›®ï¼

---

â­ **å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Star æ”¯æŒä¸€ä¸‹ï¼**
